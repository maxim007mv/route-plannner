<div class="form-container">
  <button class="back-button" (click)="goBack()">‚Üê –ù–∞–∑–∞–¥</button>

  <h2 class="form-title">{{getStepTitle()}}</h2>

  <form [formGroup]="routeForm" (ngSubmit)="onSubmit()" *ngIf="!generatedRoute">
    <!-- Step 1: Companions -->
    <div *ngIf="currentStep === 1" class="form-step">
      <div class="companion-buttons">
        <button
          type="button"
          *ngFor="let companion of companions"
          [class.selected]="routeForm.get('withWhom')?.value === companion.value"
          (click)="selectCompanion(companion.value)"
          class="companion-btn">
          <span class="icon">{{companion.icon}}</span>
          <span>{{companion.value}}</span>
        </button>
      </div>
    </div>

    <!-- Step 2: Time and Duration -->
    <div *ngIf="currentStep === 2" class="form-step">
      <div class="form-group">
        <label>–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</label>
        <input
          type="time"
          formControlName="startTime"
          [class.invalid]="isFieldInvalid('startTime')">
      </div>

      <div class="form-group">
        <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≥—É–ª–∫–∏</label>
        <select
          formControlName="duration"
          [class.invalid]="isFieldInvalid('duration')">
          <option value="2">2 —á–∞—Å–∞</option>
          <option value="3">3 —á–∞—Å–∞</option>
          <option value="4">4 —á–∞—Å–∞</option>
          <option value="5">5 —á–∞—Å–æ–≤</option>
        </select>
      </div>
    </div>

    <!-- Step 3: Interests -->
    <div *ngIf="currentStep === 3" class="form-step">
      <div class="interests-grid">
        <button
          type="button"
          *ngFor="let interest of interests"
          [class.selected]="routeForm.get('interests')?.value?.includes(interest.value)"
          (click)="toggleInterest(interest.value)"
          class="interest-btn">
          <span class="icon">{{interest.icon}}</span>
          <span>{{interest.label}}</span>
        </button>
      </div>
    </div>

    <!-- Step 4: Preferences -->
    <div *ngIf="currentStep === 4" class="form-step">
      <div class="form-group">
        <label>–ë—é–¥–∂–µ—Ç –Ω–∞ –∫–∞—Ñ–µ</label>
        <select
          formControlName="cafeBudget"
          [class.invalid]="isFieldInvalid('cafeBudget')">
          <option value="budget">–≠–∫–æ–Ω–æ–º–Ω—ã–π (–¥–æ 1000‚ÇΩ)</option>
          <option value="medium">–°—Ä–µ–¥–Ω–∏–π (1000-2000‚ÇΩ)</option>
          <option value="premium">–ü—Ä–µ–º–∏—É–º (2000‚ÇΩ+)</option>
        </select>
      </div>

      <div class="form-group">
        <label>–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è</label>
        <select
          formControlName="transportPreference"
          [class.invalid]="isFieldInvalid('transportPreference')">
          <option value="walking">–ü–µ—à–∫–æ–º</option>
          <option value="mixed">–°–º–µ—à–∞–Ω–Ω—ã–π (–ø–µ—à–∫–æ–º + —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç)</option>
          <option value="transport">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ</option>
        </select>
      </div>
    </div>

    <!-- Step 5: Additional Preferences -->
    <div *ngIf="currentStep === 5" class="form-step">
      <div class="form-group">
        <label>–¢–µ–º–ø –ø—Ä–æ–≥—É–ª–∫–∏</label>
        <select
          formControlName="pace"
          [class.invalid]="isFieldInvalid('pace')">
          <option value="relaxed">–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω—ã–π</option>
          <option value="moderate">–£–º–µ—Ä–µ–Ω–Ω—ã–π</option>
          <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
        </select>
      </div>

      <div class="checkbox-group">
        <label>
          <input type="checkbox" formControlName="accessibility">
          –ù—É–∂–µ–Ω –º–∞—Ä—à—Ä—É—Ç —Å –¥–æ—Å—Ç—É–ø–Ω–æ–π —Å—Ä–µ–¥–æ–π
        </label>
      </div>

      <div class="checkbox-group">
        <label>
          <input type="checkbox" formControlName="avoidCrowds">
          –ò–∑–±–µ–≥–∞—Ç—å –ª—é–¥–Ω—ã—Ö –º–µ—Å—Ç
        </label>
      </div>
    </div>

    <!-- Step 6: Additional Wishes -->
    <div *ngIf="currentStep === 6" class="form-step">
      <div class="form-group">
        <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∫ –º–∞—Ä—à—Ä—É—Ç—É</label>
        <textarea
          formControlName="additionalWishes"
          [class.invalid]="isFieldInvalid('additionalWishes')"
          placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–∞—à–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è—Ö, —á—Ç–æ —Ö–æ—Ç–µ–ª–∏ –±—ã —É–≤–∏–¥–µ—Ç—å –∏–ª–∏ –ø–æ—Å–µ—Ç–∏—Ç—å...">
        </textarea>
      </div>
    </div>

    <!-- Navigation buttons -->
    <div class="form-navigation">
      <button
        type="button"
        class="nav-button back"
        *ngIf="currentStep > 1"
        (click)="previousStep()">
        –ù–∞–∑–∞–¥
      </button>

      <button
        type="button"
        class="nav-button next"
        *ngIf="currentStep < totalSteps"
        [disabled]="!isCurrentStepValid()"
        (click)="nextStep()">
        –î–∞–ª–µ–µ
      </button>

      <button
        type="submit"
        class="nav-button next"
        *ngIf="currentStep === totalSteps"
        [disabled]="routeForm.invalid || isLoading">
        <span *ngIf="!isLoading">ü™Ñ –°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç</span>
        <span *ngIf="isLoading" class="loading-text">
          <span class="loader"></span>
          –°–æ–∑–¥–∞–µ–º –º–∞—Ä—à—Ä—É—Ç...
        </span>
      </button>
    </div>
  </form>

  <div *ngIf="error" class="error-message">
    ‚ö†Ô∏è {{error}}
  </div>

  <!-- Route Result -->
  <div *ngIf="generatedRoute" class="route-result">
    <h3>–í–∞—à –º–∞—Ä—à—Ä—É—Ç –≥–æ—Ç–æ–≤!</h3>
    <div *ngFor="let stage of generatedRoute.stages" class="route-stage">
      <h4>{{stage.title}}</h4>
      <p>{{stage.description}}</p>
      <div class="time">‚è∞ {{stage.time}}</div>
      <ul>
        <li *ngFor="let activity of stage.activities">{{activity}}</li>
      </ul>
    </div>
    <button class="new-route-button" (click)="resetForm()">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç</button>
  </div>
</div>
